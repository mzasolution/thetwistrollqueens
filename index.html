<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Order Twisroll Queens</title>
<style>
body{font-family:Arial; background:#f5f5f5; padding:20px; max-width:600px; margin:auto;}
h1{text-align:center;color:#c40000;margin-bottom:20px;}
.card{background:white;padding:25px;border-radius:12px;box-shadow:0 0 10px rgba(0,0,0,.1);margin-bottom:15px;}
.menu-grid{display:grid; grid-template-columns:1fr 1fr; gap:15px;}
.menu-item{border:2px solid #ddd; border-radius:12px; padding:10px; text-align:center;}
.menu-item img{width:100%; height:120px; object-fit:cover; border-radius:10px;}
.price{color:#c40000; font-weight:bold;}
.qty{width:70px;text-align:center;}
input,textarea,select{width:100%;padding:10px;margin:8px auto 15px auto;border-radius:8px;border:1px solid #ccc;display:block;box-sizing:border-box;}
.total-box{font-size:20px;font-weight:bold;text-align:right;margin-top:10px;color:#c40000;}
button{width:100%;padding:12px;background:#c40000;color:white;border:none;border-radius:8px;font-size:16px;cursor:pointer;}
button:disabled{opacity:0.6;}
.popup{display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,.5); justify-content:center; align-items:center; z-index:999;}
.popup-box{background:white;padding:25px;border-radius:12px;text-align:center; max-width:90%; box-sizing:border-box;}
.bank-info{border:2px dashed #c40000; border-radius:10px; padding:15px; margin-bottom:15px; background:#fff8f8;}

/* Detail popup styling */
.popup-detail {
  max-width: 600px;
  text-align: left;
  overflow-y: auto;
  max-height: 80vh;
  padding: 25px;
  border-radius: 15px;
  background: #fff8f8;
  box-shadow: 0 5px 20px rgba(0,0,0,0.3);
  line-height: 1.6;
  font-size: 14px;
}
.popup-detail h2 {
  text-align:center;
  font-size:22px;
}
.popup-content b {
  color:#c40000;
}
.popup-content ul, .popup-content ol {
  margin:5px 0 15px 20px;
}
.popup-content li {
  margin-bottom:6px;
}
.popup-content hr {
  border:none;
  border-top:1px dashed #c40000;
  margin:15px 0;
}
</style>
</head>
<body>

<h1>üçå The TwistRoll Queens</h1>

<form id="orderForm">
  <div class="card">
    <h3>Pilih Menu</h3>
    <div class="menu-grid">
      <div class="menu-item">
        <img src="https://raw.githubusercontent.com/mzasolution/thetwistrollqueens/main/bananawrap.png" onclick="showDetailPopup('wrap')" style="cursor:pointer;">
        <p>Twisties Banana Wrap</p>
        <p style="font-size:12px; color:#555; margin-top:-5px;">1 pack ‚Äì 10 pcs wrap</p>
        <p class="price">RM6</p>
        Qty:<input type="number" id="qty1" class="qty" value="0" min="0">
      </div>
      <div class="menu-item">
        <img src="https://raw.githubusercontent.com/mzasolution/thetwistrollqueens/main/bananaroll.png" onclick="showDetailPopup('roll')" style="cursor:pointer;">
        <p>Twissroll Banana Pastry</p>
        <p style="font-size:12px; color:#555; margin-top:-5px;">1 pack ‚Äì 10 pcs wrap</p>
        <p class="price">RM7</p>
        Qty:<input type="number" id="qty2" class="qty" value="0" min="0">
      </div>
    </div>
    <div class="total-box">Total: RM <span id="total">0.00</span></div>
  </div>

  <div class="card">
    <h3>Maklumat Pelanggan</h3>
    <input type="text" id="nama" placeholder="Nama" required>
    <input type="tel" id="phone" placeholder="No Phone" required>
    <textarea id="note" placeholder="Catatan"></textarea>

    <!-- Maklumat Bank -->
    <div class="bank-info">
      <h4 style="margin-top:0;">Maklumat Bank untuk rujukan</h4>
      <p><b>Bank:</b> Maybank</p>
      <p><b>No Akaun:</b> 12345678901234</p>
    </div>

    <!-- Upload Resit dengan teks peringatan -->
    <label>
      Upload Resit (WAJIB) <br>
      <small style="color:#c40000; font-style:italic;">
        *Sila membuat pembayaran terlebih dahulu dan upload resit pembayaran*
      </small>
    </label>
    <input type="file" id="doc" accept=".pdf,.jpg,.png,.doc,.docx" required>

    <button type="submit" id="submitBtn">Hantar Order</button>
  </div>
</form>

<!-- Order Success Popup -->
<div id="popup" class="popup">
  <div class="popup-box">
    <h3>Order Berjaya üéâ</h3>
    <p id="popupText"></p>
    <button onclick="closePopup()">OK</button>
  </div>
</div>

<!-- Detail Popup -->
<div id="detailPopup" class="popup" onclick="closeDetailPopup()">
  <div class="popup-box popup-detail" onclick="event.stopPropagation()">
    
    <!-- Buttons atas -->
    <div style="display:flex; justify-content:flex-end; gap:10px; margin-bottom:10px;">
      <button onclick="switchLang('bm')" style="background:#ffd700;color:#c40000; padding:6px 10px; border:none; border-radius:6px; cursor:pointer;">BM</button>
      <button onclick="switchLang('en')" style="background:#00aaff;color:white; padding:6px 10px; border:none; border-radius:6px; cursor:pointer;">EN</button>
    </div>
    
    <h2 id="popupTitle" style="color:#c40000; margin-top:0; text-align:center;">üìã Resepi & Cara Penyediaan</h2>
    
    <div id="popupDetail" class="popup-content"></div>
    
    <!-- Tutup button bawah -->
    <div style="margin-top:20px; text-align:center;">
      <button onclick="closeDetailPopup()" style="background:#c40000;color:white; padding:8px 12px; border:none; border-radius:6px; cursor:pointer;">Tutup</button>
    </div>
    
  </div>
</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbxxycZJa8B64dxiRpAQZOdHAPIxXFlSK92ky6GTesTu2T9IlH5rIt-Clk7BXD6zwVKX/exec";

const price1=6, price2=7;
const qty1=document.getElementById("qty1");
const qty2=document.getElementById("qty2");
const totalEl=document.getElementById("total");
const nama=document.getElementById("nama");
const phone=document.getElementById("phone");
const note=document.getElementById("note");
const fileInput=document.getElementById("doc");
const submitBtn=document.getElementById("submitBtn");

function updateTotal(){
  const total=(qty1.value*price1)+(qty2.value*price2);
  totalEl.innerText=total.toFixed(2);
}
qty1.oninput=updateTotal;
qty2.oninput=updateTotal;
updateTotal();

function showPopup(text){
  document.getElementById("popupText").innerHTML=text;
  document.getElementById("popup").style.display="flex";
}
function closePopup(){document.getElementById("popup").style.display="none";}

document.getElementById("orderForm").addEventListener("submit", async function(e){
  e.preventDefault();

  if(qty1.value==0 && qty2.value==0){alert("Sila pilih sekurang-kurangnya 1 menu"); return;}
  if(!fileInput.files.length){
    alert("‚ö†Ô∏è Sila membuat pembayaran terlebih dahulu dan upload resit pembayaran");
    return;
  }

  submitBtn.disabled=true; 
  submitBtn.innerText="Loading...";

  let menuDetail=[], totalQty=0;
  if(qty1.value>0){menuDetail.push(`Twisties Banana Wrap x${qty1.value}`); totalQty+=parseInt(qty1.value);}
  if(qty2.value>0){menuDetail.push(`Banana Roll x${qty2.value}`); totalQty+=parseInt(qty2.value);}
  const totalAmount=totalEl.innerText;

  let base64File="", fileName="";
  const file=fileInput.files[0];
  fileName=file.name;
  base64File=await new Promise(resolve=>{
    const reader=new FileReader();
    reader.onload=()=>resolve(reader.result.split(",")[1]);
    reader.readAsDataURL(file);
  });

  const data={
    nama:nama.value,
    phone:phone.value,
    menu:menuDetail.join(", "),
    qty:totalQty,
    total:totalAmount,
    note:note.value,
    file:base64File,
    fileName:fileName
  };

  try{
    const res=await fetch(scriptURL,{
      method:"POST",
      headers:{"Content-Type":"text/plain;charset=utf-8"},
      body:JSON.stringify(data)
    });
    const json=await res.json();
    if(json.error){alert("Gagal hantar order: "+json.error);}
    else{
      let msg = `No Order: <b>${json.orderId}</b><br>Total: RM ${totalAmount}`;
      showPopup(msg);
      this.reset(); 
      updateTotal();
    }
  }catch(err){alert("Gagal hantar order"); console.error(err);}

  submitBtn.disabled=false; 
  submitBtn.innerText="Hantar Order";
});

// Popup Resepi
let currentMenu = "wrap";

const popupTitle = {
  wrap: { bm: "üìã Resepi & Cara Penyediaan", en: "üìã Recipe & Method" },
  roll: { bm: "üìã Resepi & Cara Penyediaan", en: "üìã Recipe & Method" }
};

const recipes = {
  wrap: {
    bm: `
<b>TWISTIES WRAP PISANG (TANPA GORENG) ‚Äì 10 BIJI</b>
<hr>
<b>Bahan-bahan:</b>
<ul>
<li>10 keping wrap tortilla / paratha</li>
<li>4 biji pisang masak (~400 g), dilenyek ringan / dihiris nipis</li>
<li>100 g keju parut</li>
<li>50 g Twisties yang dihancurkan</li>
<li>100 g sapuan coklat / Nutella</li>
</ul>
<b>Cara Penyediaan:</b>
<ol>
<li>Panaskan wrap di atas kuali tanpa minyak.</li>
<li>Sapukan 10 g coklat pada setiap wrap.</li>
<li>Letakkan pisang (~40 g setiap wrap).</li>
<li>Taburkan 10 g keju dan 5 g Twisties yang dihancurkan.</li>
<li>Balut dengan kemas.</li>
<li>Hidangkan serta-merta atau bakar seketika sehingga keju cair.</li>
</ol>
`,
    en: `
<b>TWISTIES BANANA WRAP (NO FRY) ‚Äì 10 PCS</b>
<hr>
<b>Ingredients:</b>
<ul>
<li>10 tortilla / paratha wraps</li>
<li>4 ripe bananas (~400 g), lightly mashed or thinly sliced</li>
<li>100 g grated cheese</li>
<li>50 g crushed Twisties</li>
<li>100 g chocolate spread / Nutella</li>
</ul>
<b>Method:</b>
<ol>
<li>Heat wraps lightly on a pan (no oil).</li>
<li>Spread 10 g chocolate per wrap.</li>
<li>Place banana slices or mashed banana on top (~40 g per wrap).</li>
<li>Sprinkle 10 g cheese and 5 g crushed Twisties per wrap.</li>
<li>Wrap tightly.</li>
<li>Serve immediately or grill lightly until cheese melts.</li>
</ol>
`
  },
  roll: {
    bm: `
<b>TWISTIES ROLL PISANG (GORENG) ‚Äì 10 BIJI</b>
<hr>
<b>Bahan-bahan:</b>
<ul>
<li>10 keping kulit popia</li>
<li>4 biji pisang masak (~400 g) (Pisang Emas atau Pisang Raja)</li>
<li>100 g keju parut (cheddar atau mozzarella)</li>
<li>50 g Twisties yang dihancurkan (sebarang perisa)</li>
<li>2‚Äì3 sudu besar susu pekat manis (pilihan)</li>
<li>300 ml minyak masak (untuk menggoreng)</li>
</ul>
<b>Cara Penyediaan:</b>
<ol>
<li>Letakkan sebiji pisang di atas sekeping kulit popia.</li>
<li>Taburkan 10 g keju per gulungan.</li>
<li>Masukkan 5 g Twisties yang dihancurkan setiap gulungan.</li>
<li>Siram sedikit susu pekat manis jika suka.</li>
<li>Gulung kemas dan lekatkan hujung dengan sedikit air.</li>
<li>Goreng dengan api sederhana sehingga keemasan dan rangup (¬±2‚Äì3 minit setiap bahagian).</li>
<li>Toskan minyak berlebihan dan hidangkan panas.</li>
</ol>
`,
    en: `
<b>TWISTIES BANANA ROLL (FRIED) ‚Äì 10 PCS</b>
<hr>
<b>Ingredients:</b>
<ul>
<li>10 spring roll wrappers</li>
<li>4 ripe bananas (~400 g) (Pisang Emas or Pisang Raja)</li>
<li>100 g grated cheese (cheddar or mozzarella)</li>
<li>50 g crushed Twisties (any flavor)</li>
<li>2‚Äì3 tbsp condensed milk (optional)</li>
<li>300 ml cooking oil (for frying)</li>
</ul>
<b>Method:</b>
<ol>
<li>Place a banana on a spring roll wrapper.</li>
<li>Sprinkle 10 g grated cheese per roll.</li>
<li>Add 5 g crushed Twisties per roll.</li>
<li>Drizzle condensed milk if desired.</li>
<li>Roll tightly and seal the edge with water.</li>
<li>Fry over medium heat until golden and crispy (~2‚Äì3 min each side).</li>
<li>Drain excess oil and serve hot.</li>
</ol>
`
  }
};

function showDetailPopup(menu){
  currentMenu = menu;
  switchLang('bm');
  document.getElementById("detailPopup").style.display = "flex";
}
function switchLang(lang){
  document.querySelector("#detailPopup h2").innerHTML = popupTitle[currentMenu][lang];
  document.getElementById("popupDetail").innerHTML = recipes[currentMenu][lang];
}
function closeDetailPopup(){
  document.getElementById("detailPopup").style.display = "none";
}
</script>

</body>
</html>
